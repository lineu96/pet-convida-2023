---
title: \textbf{Um estudo de caso de análise de comportamento animal usando GAMLSS}
#subtitle: R, história, pacotes, RStudio e primeiro contato
author: Prof. Me. Lineu Alberto Cavazani de Freitas
date: ""
institute: |
 | Departamento de Estatística
 | Laboratório de Estatística e Geoinformação
graphics: yes
classoption: [serif, professionalfont, usenames, dvipsnames, aspectratio = 169]
 #bibliography: references.bib
 #csl: ../config/ABNT_UFPR_2011-Mendeley.csl
output:
  beamer_presentation:
    fig_caption: yes
    fig_crop: no
    highlight: haddock
    includes:
      # NOTE: background, color theme and logos are defined in `preamble-rmd-settings.tex`.
      in_header: [config/preamble-settings-rmd.tex, config/preamble-global.tex, config/preamble-chunk-rmd.tex, config/preamble-commands.tex]
    keep_tex: yes
# http://rmarkdown.rstudio.com/beamer_presentation_format.html
---

```{r, include = FALSE}
source("./config/setup.R")
```

# Introdução

## Estudos de comportamento animal

 - O \textbf{comportamento de um animal} reflete seu \textbf{estado emocionais}.
 
 - Estudos de comportamento animal forneceram informações úteis sobre o bem-estar animal em uma ampla variedade de situações.

 - Tais estudos costumam produzir \textbf{dados complexos} e \textbf{não estruturados}, registrados a partir de áudios, imagens e vídeos, entre outros.

 - Estes dados não estruturados, quando tratados, são fontes de \textbf{diversas variáveis aleatórias}.
 
## Estudos de comportamento animal

Por exemplo: 

 - Considere que a movimentação de cabeça de um animal em contato com um ser humano reflete algum estado emocional.

 - Para avaliar a movimentação de cabeça podemos:

      1. Verificar se cada animal apresentou ou não o comportamento específico, configurando um \textbf{resultado binário}. 

      2. Avaliar o número de vezes que o comportamento foi repetido, gerando uma \textbf{variável de contagem}. 

      3. Avaliar a proporção do tempo em que o animal realizou o movimento, gerando uma \textbf{variável contínua}. 

      4. Registrar o tempo até a ocorrência de um evento, gerando um \textbf{dado censurado}. 

## Estudos de comportamento animal

 - Estudos de comportamento animal costumam apresentar diversos outros fatores que devem ser levados em consideração na análise estatística. 

\beginAHalfColumn

  - Unidades agrupadas (ninhadas, rebanhos). 

  - Estudos longitudinais (cada animal é avaliado em diferentes momentos).

  - Estudos espaciais (coordenadas espaciais são relevantes para a análise).

\endColumns
\beginAHalfColumn

  - Relações não lineares.
      
  - Heterocedasticidade.
      
  - Assimetria e/ou curtose.
      
  - Super ou subdispersão.
      
  - Inflação zeros.

\endColumns

## Modelos de regressão

\beginAHalfColumn

 - Devido a estas características a análise estatística de dados de comportamento animal requer \textbf{modelos flexíveis}, capazes de lidar com as características dos dados.
 
 - Em geral, são usados \textbf{modelos de regressão}.

\endColumns
\beginAHalfColumn



\endColumns

## Modelos de regressão

 - \textbf{Fenômeno aleatório}: situação na qual diferentes observações podem fornecer diferentes desfechos. 
  
 - \textbf{Variáveis aleatórias}: mecanismos que associam um valor numérico a cada desfecho possível do fenômeno. 
  
 - \textbf{Distribuições de probabilidade}: modelos probabilísticos que buscam descrever as probabilidades de variáveis aleatórias.

## Modelos de regressão

 - Na prática, podemos buscar uma \textbf{distribuição de probabilidades} que melhor descreva o fenômeno de interesse. 
  
 - Estas \textbf{distribuições} são descritas por \textbf{funções}. 
  
 - Estas funções possuem \textbf{parâmetros} que controlam aspectos da distribuição.
  
 - Os parâmetros são \textbf{quantidades desconhecidas, estimadas} por meio dos dados.

## Modelos de regressão

 - Em regressão \textbf{modelamos parâmetros} das distribuições como uma função de \textbf{variáveis explicativas}.
  
 - O parâmetro de interesse é decomposto em uma combinação linear de novos parâmetros que associam as \textbf{variáveis explicativas} à \textbf{variável resposta}.
  
 - Obtém-se uma \textbf{equação que explique a relação} entre as variáveis. 
 
## Modelos de regressão

```{r, echo = FALSE, out.width = "11cm"}
knitr::include_graphics("./img/modelos_regressao.pdf")
```

## Modelos de regressão

 1. \textbf{Definição do problema.}
    - Qual o fenômeno aleatório de interesse?
    - Que fatores externos podem afetar este fenômeno?

 2. \textbf{Análise dos dados via regressão.}
    - Distribuição de probabilidade.
    - Especificação do modelo.
    - Obtenção dos parâmetros (ajuste).
    - Diagnóstico.
      
 3. \textbf{Interpretação dos resultados.}
    - Quais os fatores externos apresentam ou não impacto sobre o fenômeno.
    - Qual a dimensão desse impacto.
    
## GAMLSS

 - GAMLSS: \textbf{generalized additive models for location, scale and shape}.

 - É um \textbf{framework} para ajuste de modelos de regressão. 

 - Dispõe de um grande conjunto de \textbf{distribuições}.

 - Permite modelar cada parâmetro de distribuição incluindo \textbf{covariáveis}, \textbf{efeitos aleatórios} e \textbf{suavizadores}. 

## GAMLSS

 - Desta forma, várias das restrições relacionadas aos dados de comportamento animal podem ser adequadamente tratadas.
 
  - Os \textbf{efeitos aleatórios} são uma ferramenta adequada para lidar com dados multiníveis e permitem acomodar adequadamente a \textbf{estrutura de correlação} resultante de projetos de medidas repetidas. 
  
  - Os \textbf{suavizadores} são úteis na modelagem de \textbf{relacionamentos não lineares} entre os parâmetros de distribuição e as covariáveis contínuas.
  
## Pontos vistos até aqui

\beginAHalfColumn

 - Dados de comportamento animal.
 	- Objetivo.
 	- Tipos de resposta.
 	- Especificidades dos dados.
 	
 - Modelos de regressão.
 	- Ideia geral.
  	- GAMLSS.

\endColumns
\beginAHalfColumn

\endColumns

## Objetivo

 - O estudo teve como objetivo explorar o potencial do \textbf{GAMLSS} na \textbf{análise de comportamento animal}.

 - Os dados que motivaram o estudo é de \textbf{comportamento de ovinos} em que buscou-se avaliar se \textbf{intervenção humana} e \textbf{isolamento social} influenciam o comportamento dos animais.

 - A amostra era composta por \textbf{20 ovinos} pertencentes a \textbf{duas linhagens genéticas} diferentes.
 
## Objetivo

\beginAHalfColumn

 - Dentre as principais informações resultantes deste experimento podemos destacar dois tipos de variáveis: 
	1. O \textbf{número de mudanças} posturais.
	2. A \textbf{proporção} (ou percentual) de tempo que cada postura foi expressa. 

\endColumns
\beginAHalfColumn

 - Uma série de respostas foi observada, como
 	1. Posturas de \textbf{orelha} (levantadas, horizontais e assimétricas). 
 	2. Postura dos \textbf{olhos} (fechados, semicerrados e abertos). 
 	3. Comportamento \textbf{alimentar} (comendo, ruminando, não comendo ou ruminando).

 	entre outros.

\endColumns
 	
## Objetivo

\beginAHalfColumn

 - A título de ilustração, consideramos duas variáveis de tipos distintos: 
	  - O \textbf{número de mudanças} de postura de orelha.
	  - A \textbf{proporção} de tempo realizando a postura de orelha horizontal.

\endColumns
\beginAHalfColumn	

 - Ovelhas submetidas a eventos positivos:
 	  - Apresentam altas proporções de posturas de orelha horizontais.
 	  - Menos alterações de postura de orelha do que ovelhas em situações negativas.

\endColumns


# Estudo de caso

## Estudo de caso

\beginAHalfColumn

 - Foram observadas \textbf{20 ovelhas} pertencentes a \textbf{2 linhagens genéticas}, que foram \textbf{submetidas à escovação} por um humano que lhes era familiar.
 
 - Verificou-se o número de alterações de postura e as proporções de tempo em que os animais permaneciam em determinadas posturas.

\endColumns
\beginAHalfColumn

```{r, echo = FALSE, out.width='70%', fig.align='center', fig.cap="Fotografia dos animais sob análise."}
knitr::include_graphics("./img/animais.png")
```

\endColumns

## Estudo de caso

```{r, echo = FALSE, out.width='55%', fig.align='center', fig.cap="Fotografia dos animais sob análise."}
knitr::include_graphics("./img/animais2.png")
```

## Estudo de caso

O experimento foi conduzido em \textbf{três sessões experimentais}:

 1. Na primeira havia uma grade de metal separando o animal testado dos demais animais, \textbf{sem distância} entre eles.

 2. Na segunda havia duas grades de metal separando o animal testado dos demais animais a uma \textbf{distância de 1,7 m}.
	
 3. Na terceira sessão os animais voltaram a ser separados por apenas uma grade, \textbf{sem distanciamento} dos demais animais.

## Estudo de caso

```{r, echo = FALSE, out.width='70%', fig.align='center', fig.cap="Esquema sessões 1 e 3 (sem isolamento)."}
knitr::include_graphics("./img/se1_se3.png")
```

## Estudo de caso

```{r, echo = FALSE, out.width='70%', fig.align='center', fig.cap="Esquema sessão 2 (com isolamento)."}
knitr::include_graphics("./img/se2.png")
```

## Estudo de caso

```{r, echo = FALSE, out.width='60%', fig.align='center', fig.cap="Foto sessão."}
knitr::include_graphics("./img/isol.png")
```

## Estudo de caso

Em cada sessão, as ovelhas foram observadas em \textbf{3 momentos} distintos:

 1. Fase de \textbf{pré escovação}, com duração de 2 minutos e 30 segundos.

 2. Fase de \textbf{escovação}, com duração de 3 minutos.

 3. Fase de \textbf{pós escovação}, com duração de 2 minutos e 30 segundos.

## Estudo de caso

```{r, echo = FALSE, out.width='55%', fig.align='center', fig.cap="Fotografia animal sob intervenção humana (escovação)."}
knitr::include_graphics("./img/escov.png")
```

## Estudo de caso

Temos \textbf{3 variáveis categóricas}:

 1. \textbf{Linhagem}: fator de 2 níveis que classifica os animais como reativos (R+) ou não reativos (R-).
 
 2. \textbf{Sessão}: fator de 3 níveis que indica a sessão experimental de acordo com o isolamento social (sessões 1 e 3 sem isolamento, sessão 2 com isolamento).
 
 3. \textbf{Momento}: fator de 3 níveis que indica se o animal está ou não sob intervenção humana (antes, durante ou depois da intervenção).

Temos \textbf{2 respostas} distintas:

 1. Número de mudanças de postura de orelha.
 2. Proporção do tempo com as orelhas em posição neutra.	
	
## Estudo de caso

 - Considerando as combinações entre as variáveis, \textbf{cada animal} contribui com \textbf{9 medidas} ao conjunto de dados.

 - Portanto existe uma estrutura de medidas repetidas.

```{r, echo = FALSE, out.width='55%', fig.align='center', fig.cap="Combinação entre sessão e momento."}
knitr::include_graphics("./img/se_mo.png")
```

# GAMLSS

## GAMLSS

Para definição de um GAMLSS considere:

 - Um conjunto de observações $Y_i, \ i=1,2,\ldots,n$. 
 - As observações seguem função (densidade) de probabilidade $f_Y(y_i|\theta)$ parametrizada por $\theta = (\theta_{1}, ..., \theta_{p})^T$. 
 - $\theta$ é um vetor de $p$ até 4 parâmetros distribucionais denotados por $(\mu, \sigma, \nu, \tau)^T$ se $p=4$.

 - Geralmente (mas não necessariamente) $\mu$ e $\sigma$ representam os parâmetros de locação e dispersão, enquanto que $\nu$ and $\tau$ representam parâmetros de forma.
 
## GAMLSS

\begin{equation}\label{eq.gamlss}
	\begin{aligned}
		g_{k}(\theta_{k}) = \eta_{k} = X_{k} \beta_{k} + \sum_{j=1}^{J_{k}} Z_{jk} \gamma_{jk},\ k=1,2,3,4,
	\end{aligned}
\end{equation}

- $g_{k}(\cdot)$ são funções de ligação que relacionam o $k$-ésimo parâmetro distribucional ao preditor $\eta_{k}$. 
 
 - $\beta_{k} = (\beta_{1k},\beta_{2k},\ldots,\beta_{J_{K}^{'}k})^T$ é um vetor de parâmetros de regressão de dimensão $J_{K}^{'}$, 
 
 - $X_{k}$ e $Z_{jk}$ são matrizes de delineamento de ordem $n \times J_{k}^{'}$ e $n \times q_{jk}$, respectivamente. 
 
 - $\gamma_{jk}$ é um vetor aleatório de dimensão $q_{jk}$ para os quais assume-se que $\gamma_{jk} \sim \text{N}_{q_{jk}}(0, G_{jk}^{-1})$.
 
 - $G_{jk}^{-1}$  é a inversa generalizada da matriz simétrica $G_{jk} = G_{jk}(\lambda_{jk})$ de ordem $q_{jk} \times q_{jk}$ 
 
  - $\lambda_{jk}$ é um vetor de hiperparâmetros.
  
## GAMLSS 

 - Os parâmetros de regressão ($\beta_{k}$) e os efeitos aleatórios ($\gamma_{jk}$) são usualmente estimados na maximização de uma log-verossimilhança penalizada ($l_p$), dada por

\begin{equation}\label{eq.loglik}
	\begin{aligned}
		l_p = l-\frac{1}{2} \sum_{k=1}^{p} \sum_{j=1}^{J_k} \lambda_{jk} \gamma_{jk}^{'} G_{jk} \gamma_{jk},
	\end{aligned}
\end{equation}

 - $l = \sum_{i=1}^{n} \log(f(y_i|\theta))$ representa a log-verossimilhança. 

 - A log-verossimilhança penalizada se reduz à usual log-verossimilhança quando não há efeitos aleatórios ou termos suavizadores no modelo.
 
# Aplicação

## Procedimento de análise

Respostas

 1. Número de mudanças de postura de orelha.
 2. Proporção do tempo com as orelhas em posição neutra.

Procedimento para o número de mudanças de postura de orelha:

1. Seleção de distribuições compatíveis com o problema.
2. Ajuste de modelos com o mesmo preditor para todas as distribuições.
3. Seleção do modelos via medidas de qualidade de ajuste OU análise gráfica.
4. Busca do menor modelo possível que não difirisse do modelo inicial.
5. Interpretação dos resultados. 

# Número de mudanças de postura de orelha

## Número de mudanças de postura de orelha

```{r, echo = FALSE, out.width='95%', fig.align='center', fig.cap="Análise exploratória do número de mudanças de postura de orelha."}
knitr::include_graphics("./img/count.pdf")
```

## Distribuições 

 - Poisson (PO)
 - Negative binomial distribution (NBI)
 - Zero inflated Poisson distribution (ZIP)
 - Zero inflated negative binomial distribution (ZINBI)
 - Zero adjusted Poisson distribution (ZAP)
 - Zero adjusted negative binomial distribution (ZANBI)

## Preditor

 - Para cada distribuição os modelos foram especificados com os efeitos fixos de sessão, momento, linhagem e as interações duas a duas.

 - Adicionalmente foram incluídos 2 efeitos aleatórios: um a nível de animal e outro a nível de animal dentro de sessão.

 - Os efeitos aleatórios foram usados devido à necessidade de incorporar as correlações causadas pela estrutura de medidas repetidas (9 medidas por animal).

 - 

## 

\begin{table}[h]
	\centering
	\caption{Goodness-of-fit measures for the fitted models with different probability distributions.}
	\begin{tabular}{lcccc}
		\hline
		{\color[HTML]{000000} Model} & {\color[HTML]{000000} Likelihood} & {\color[HTML]{000000} Degrees of Freedom} & {\color[HTML]{000000} AIC}     \\ \hline
		{\color[HTML]{000000} \text{PO}}    & {\color[HTML]{000000} -547.34}    & {\color[HTML]{000000} 48.17}     & {\color[HTML]{000000} 1191.03} \\
		{\color[HTML]{000000} \text{NBI}}   & {\color[HTML]{000000} -479.78}    & {\color[HTML]{000000} 47.59}     & {\color[HTML]{000000} 1054.74} \\
		{\color[HTML]{000000} \text{ZIP}}   & {\color[HTML]{000000} -496.69}    & {\color[HTML]{000000} 63.70}     & {\color[HTML]{000000} 1120.78} \\
		{\color[HTML]{000000} \text{ZINBI}} & {\color[HTML]{000000} -462.66}    & {\color[HTML]{000000} 54.37}     & {\color[HTML]{000000} 1034.06} \\
		{\color[HTML]{000000} \text{ZAP}}   & {\color[HTML]{000000} -498.24}    & {\color[HTML]{000000} 63.34}     & {\color[HTML]{000000} 1123.16} \\
		{\color[HTML]{000000} \text{ZANBI}} & {\color[HTML]{000000} -463.16}    & {\color[HTML]{000000} 55.02}     & {\color[HTML]{000000} 1036.36} \\ \hline
	\end{tabular}
	\label{tab:tab1}
\end{table}

##

\begin{table}[h]
	\centering
	\caption{Goodness-of-fit measures and LRTs for the nested \text{ZANBI} models.}
	\begin{tabular}{lccccc}
		\hline
		{\color[HTML]{000000} Model} & {\color[HTML]{000000} Likelihood} & {\color[HTML]{000000} Degrees of Freedom} & {\color[HTML]{000000} AIC}     & {\color[HTML]{000000} P-value}         \\ \hline
		{\color[HTML]{000000} Fit 1} & {\color[HTML]{000000} -463.16}    & {\color[HTML]{000000} 55.02}              & {\color[HTML]{000000} 1036.36} & {\color[HTML]{000000} -}               \\
		{\color[HTML]{000000} Fit 2} & {\color[HTML]{000000} -463.86}    & {\color[HTML]{000000} 47.48}              & {\color[HTML]{000000} 1022.67} & {\color[HTML]{000000} 0.991}            \\
		{\color[HTML]{000000} Fit 3} & {\color[HTML]{000000} -476.15}    & {\color[HTML]{000000} 42.48}              & {\color[HTML]{000000} 1037.25} & {\color[HTML]{000000} 0.014} \\ \hline
	\end{tabular}
	\label{tab:tab2}
\end{table}

## 

```{r, echo = FALSE, out.width='95%', fig.align='center', fig.cap="Análise exploratória da proporção do tempo com as orelhas em posição neutra."}
knitr::include_graphics("./img/mzanbi.png")
```


# Proporção do tempo com as orelhas em posição neutra

## Proporção do tempo com as orelhas em posição neutra

```{r, echo = FALSE, out.width='95%', fig.align='center', fig.cap="Análise exploratória da proporção do tempo com as orelhas em posição neutra."}
knitr::include_graphics("./img/prop.pdf")
```

##

## 

```{r, echo = FALSE, out.width='95%', fig.align='center', fig.cap="Análise exploratória da proporção do tempo com as orelhas em posição neutra."}
knitr::include_graphics("./img/mbetas.png")
```

##

```{r, echo = FALSE, out.width='95%', fig.align='center', fig.cap="Análise exploratória da proporção do tempo com as orelhas em posição neutra."}
knitr::include_graphics("./img/interaction.png")
```

# Considerações finais

## Considerações finais

 - Neste trabalho exploramos a flexibilidade do GAMLSS na análise de dados de comportamento animal.

 - Dois tipos de variáveis comuns a este tipo de estudo foram analisadas: um contagem e uma proporção.

 - No estudo de caso o objetivo era investigar o efeito de isolamento social, intervenção humana e linhagem dos animais.

 - Os dados apresentavam uma estrurura multinível, super-dispersão, inflação de zeros e efeito de covariáveis em mais de um parâmetro.

 - Com GAMLSS foi possível analisar adequadamente ambas as respostas considerando todas as especificidades do problema e provendo resultados confiáveis e consistentes.
